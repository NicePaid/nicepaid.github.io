<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App with ThemeParams</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    
    <!-- Скрипт для подключения мини-приложения к клиенту Telegram -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
    
<body>
    <div id="app">
        <h1 id="title">Hello, Telegram!</h1>
        <p id="description">This is a mini app that adjusts to the Telegram theme.</p>
        <div id="user-info">userinfo</div>
        <button id="go-to-channels">Каналы и Группы</button>
    </div>

    <script> 
        // Запуск WebApp для обработки метода
        Telegram.WebApp.ready();

        // Включение подтверждения при закрытии мини-приложения
        Telegram.WebApp.isClosingConfirmationEnabled = true;

        const user = Telegram.WebApp.initDataUnsafe.user;
        const userInfoDiv = document.getElementById('user-info');
        
        if (user) {
            userInfoDiv.innerHTML = `
                <p>First Name: ${user.first_name}</p>
                <p>Last Name: ${user.last_name}</p>
                <p>Username: ${user.username}</p>
                <p>ID: ${user.id}</p>
            `;
        }

        // Метод для получения и отображения каналов, где пользователь является администратором
        async function fetchAdminChannels() {
            const botToken = 'YOUR_BOT_TOKEN'; // Замените на токен вашего бота
            const userId = user.id;
            
            try {
                const response = await fetch(`https://api.telegram.org/bot${botToken}/getUpdates`);
                const data = await response.json();
                
                const channels = data.result.filter(update => 
                    update.message && update.message.chat.type === 'channel' &&
                    update.message.from.id === userId
                );

                const channelsDiv = document.createElement('div');
                channelsDiv.id = 'channels';
                channelsDiv.innerHTML = '<h2>Ваши каналы:</h2>';
                
                channels.forEach(channel => {
                    const channelDiv = document.createElement('div');
                    channelDiv.className = 'channel';
                    channelDiv.innerHTML = `
                        <p>Название канала: ${channel.message.chat.title}</p>
                        <button onclick="addBotToChannel('${channel.message.chat.id}')">Добавить бота</button>
                    `;
                    channelsDiv.appendChild(channelDiv);
                });
                
                document.getElementById('app').appendChild(channelsDiv);
            } catch (error) {
                console.error('Ошибка при получении каналов:', error);
            }
        }

        // Метод для добавления бота в канал
        function addBotToChannel(channelId) {
            const botUsername = 'your_bot_username'; // Замените на имя вашего бота
            const url = `https://t.me/${botUsername}?startgroup=new&admin=${channelId}`;
            window.open(url, '_blank');
        }

        // Обработчик кнопки для перехода на страницу добавления бота в каналы и группы
        const goToChannelsButton = document.getElementById('go-to-channels');
        goToChannelsButton.addEventListener('click', () => {
            fetchAdminChannels();
        });

        Telegram.WebApp.MainButton.setText("Начало работы!");
        Telegram.WebApp.MainButton.show();
        Telegram.WebApp.onEvent('mainButtonClicked', function() {
            alert('Main button was clicked!');
        });
    </script>
</body>
</html>
